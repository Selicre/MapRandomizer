<!DOCTYPE html>
<html lang="en-US">
    <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Super Metroid Map Rando</title>
    <link rel="shortcut icon" type="image/x-icon" href="/static/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    </head>
    <body>
    <div class="container">
        <div class="row">
            <div class="col-9 text-center my-2">
                <img src="/static/WebTitle.png" alt="Super Metroid Map Rando" style="width: 50%">
            </div>
            <div class="col-3" align=right>
                <small>Version: <%= version %></small>
            </div>
        </div>
        <form id="main-form" method="POST" enctype="multipart/form-data" action="/randomize">
            <div class="form-group row my-2">
                <label class="col-sm-2 col-form-label" for="rom">Input ROM</label>
                <input class="col-sm-10 form-control-file" type="file" id="rom" name="rom">
            </div>
            <div class="form-group row my-2">
                <label class="col-sm-2 col-form-label" for="preset">Item placement</label>
                <div class="col-sm-4 btn-group" role="group">
                <% for &name in &item_placement_strategies {
                        let checked = if name == "Open" { "checked" } else { "" };
                     %>
                    <input type="radio"
                        class="btn-check" 
                        name="item_placement_strategy" 
                        id="itemPlacementStrategy<%- name %>"
                        value="<%- name %>"
                        autocomplete="off"
                        onclick="presetChanged()"
                        <%- checked %>>
                    <label class="btn btn-outline-primary" for="itemPlacementStrategy<%- name%>"><%= name %></label>
                <% } %>
                </div>
            </div>
            <div class="form-group row my-2 mx-2">
                <small><strong>Open</strong>: Key items, tanks, and ammo are placed throughout the game in
                roughly a uniformly random way (subject to logic constraints to ensure the game is beatable), 
                which generally allows multiple pathways for progression.</small>                    
            </div>
            <div class="form-group row my-2 mx-2">
                <small><strong>Semiclosed</strong>: Key items are placed sparingly until the final stage of
                item placement, tending to limit the player to a single intended progression sequence for much
                of the game. Energy Tanks are placed in roughly a uniformly random way, as are additional Super and
                Power Bomb packs after the first pack.</small>
            </div>
            <div class="form-group row my-2 mx-2">
                <small><strong>Closed</strong>: Key items, tanks, and ammo (other than Missiles) are placed
                sparingly until the final stage of item placement, tending to limit the player to a single intended
                progression sequence and limited resources for much of the game.</small>
            </div>
            <div class="form-group row my-2">
                <label class="col-sm-2 col-form-label" for="preset">Skill assumption</label>
                <div class="col-sm-10 btn-group" role="group">
                <% for (i, p) in preset_data.iter().enumerate() { 
                    let name = &p.preset.name;
                    let name_no_space = &p.preset.name.replace(" ", "");
                    let checked = if i == 0 { "checked" } else { "" }; 
                    %>
                    <input type="radio" class="btn-check" name="preset" value="<%- name %>"
                        id="preset<%- name_no_space%>" autocomplete="off" onclick="presetChanged()" <%- checked %>>
                    <label class="btn btn-outline-primary" for="preset<%- name_no_space %>"><%= name %></label>
                <% } %>
                 </div>
            </div>
            <div class="form-group row my-2 mx-2">
                <small><strong>Note</strong>: Even on the "Easy" difficulty, the seeds can be challenging,
                particularly in the early game. We are still working on improvements to better align the game's
                difficulty with the intended level.
            </div>
            <div class="accordion my-2" id="accordion">
                <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDifficulty">
                    Customize skill assumptions
                    </button>
                </h2>
                <div id="collapseDifficulty" class="accordion-collapse collapse m-2">
                    <div class="form-group row m-2">
                    <label for="shinesparkTiles" class="col-sm-6 col-form-label">Shinespark tiles<br>
                    <small>(Smaller values assume ability to short-charge over shorter distances)</small>
                    </label>
                    <div class="col-sm-2">
                        <input type="text" class="form-control" name="shinespark_tiles" id="shinesparkTiles" value="32">
                    </div>
                    </div>
                    <div class="form-group row m-2">
                    <label for="resourceMultiplier" class="col-sm-6 col-form-label">Resource multiplier<br>
                    <small>(Leniency factor on assumed energy & ammo usage)</small>
                    </label>
                    <div class="col-sm-2">
                        <input type="text" class="form-control" name="resource_multiplier" id="resourceMultiplier" value="3.0">
                    </div>
                    </div>
                    <div class="form-group row m-2">
                    <label for="escapeTimerMultiplier" class="col-sm-6 col-form-label">Escape timer multiplier<br>
                    <small>(Leniency factor on escape timer)</small>
                    </label>
                    <div class="col-sm-2">
                        <input type="text" class="form-control" name="escape_timer_multiplier" id="escapeTimerMultiplier" value="3.0">
                    </div>
                    </div>
                    <div class="form-group row m-2">
                        <label class="col-sm-6 col-form-label" for="preset">Save the animals<br>
                        <small>(Take into account extra time needed in the escape)</small></label>
                        <div class="col-sm-4 btn-group my-3" role="group">
                            <input type="radio" class="btn-check" name="save_animals" id="saveAnimalsNo" value="No" checked=true>
                            <label class="btn btn-outline-primary" for="saveAnimalsNo">No</label>
                            <input type="radio" class="btn-check" name="save_animals" id="saveAnimalsYes" value="Yes">
                            <label class="btn btn-outline-primary" for="saveAnimalsYes">Yes</label>
                        </div>
                    </div>
                    <div class="form-group row my-2">
                    <div class="col-sm-12">
                        <div class="accordion my-2" id="accordion">
                            <% include!("tech.stpl"); %>
                        </div>
                    </div>
                    </div>
                </div>
                </div>
            </div>
            <div class="form-group row my-2">
                <label for="randomSeed" class="col-sm-2 col-form-label">Random seed</label>
                <div class="col-sm-3">
                <input type="text" class="form-control" name="random_seed" id="randomSeed" value="">
                </div>
            </div>
            <div class="form-group row my-2">
                <div class="col-sm-12">
                    <input type="submit" class="btn btn-primary" value="Generate ROM" />
                </div>
            </div>
        </form>
        <small><strong>Note</strong>: ROM may take a while to generate. For fastest results, click "Generate ROM" only once and wait patiently. 
        If it times out, try again with a different random seed. This is still in an alpha stage of development, 
        so bugs are expected. If you encounter a problem, 
        feedback is welcome on <a href="https://github.com/blkerby/MapRandomizer/issues">GitHub issues</a>. 
        Also feel free to stop by the <a href="https://discord.gg/Gc99YV2ZcB">Discord</a>: let us know if you
        find a cool seed (or a broken seed), if you have questions or ideas for future development, or if you're 
        streaming the game!</small>
        <div class="row my-2">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-header">Things to know</div>
                    <div class="card-body">
                        <ul>
                        <li>Certain items do not spawn until the planet is 
                        awakened, by exiting Pit Room (old Mother Brain
                        room) with Morph and Missiles collected.<a href="#footnote-pit-room"><sup>1</sup></a>
                        <li>Certain items do not spawn until Phantoon has been
                        defeated.
                        <li>Phantoon's Room is always two rooms away from the Wrecked Ship Map Room, and both are 
                            in the same area as the Wrecked Ship Save Room.
                        <li>Items are always marked by dots on the map. Map stations, refills, 
                        and major bosses (G4 and Mother Brain) are marked by special tiles.
                        <li>Missile Refill stations refill all ammo types: Missiles, Supers, and Power Bombs.
                        <li>Gravity and Varia behave like Progressive Suits in other randomizers,
                        each giving 50% reduction in enemy damage (stacking to a combined 75%).
                        <li>Mother Brain has been changed to take double damage from Supers.
                        <li>The current tile can be marked un-explored on the map  
                        by pressing Angle Up and Item Cancel simultaneously. To be effective, these inputs must be
                        held while exiting the tile, since otherwise the game will immediately re-explore the tile.
                        <li>Saving at a different save station from the last save will advance to the next slot 
                        before saving, so you can return to an earlier save in case you get stuck.
                        <li>Samus collects & equips all items (excluding beams, ammo, and tanks) when acquiring Hyper Beam.
                        </ul>
                        <p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row my-2">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-header">Known issues</div>
                    <div class="card-body">
                        <ul>
                        <li>Even if the tech is not selected, wall jumps and crouch-jump/down-grabs may be required in some places.
                        <li>Some sound effects are glitched (due to changing the music).
                        <li>Door transitions generally have some minor graphical glitches.
                        <li>The end credits are vanilla.
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="row my-2">
            <div class="col-sm-12">
                <div class="card">
                    <div class="card-header">Change log</div>
                    <div class="card-body">
                        <% include!("changelog.stpl"); %>
                    </div>
                </div>
            </div>
        </div>
        <div class="row my-2">
            <div class="col-sm-12">
                <a id="footnote-pit-room">
                <sup>1</sup> Technically the planet is awakened by opening any gray door locked by an enemy kill 
                count (which does <i>not</i> include gray doors locked by boss kills).
                In the vanilla game, such gray doors spawn in the Pit Room when entering with Morph and Missiles but
                are also in other rooms (e.g., Spore Spawn Kihunters, Brinstar Pre-Map Room). In 
                Map Rando, at least for now, all gray doors are removed except in the Pit Room, making the Pit Room
                the only place where the planet can be awakened. Note that Pit Room also has an item that only
                spawns when entering with Morph and Missiles (regardless of whether the planet is awake).
            </div>
        </div>
    </div>
    <% include!("scripts.stpl"); %>
    </body>
</html>