TODO:
- fix GFX that we overwrote with custom tiles
  - probably switch the new-game GFX (e.g. controller config) to use a separate bank, to free up tiles
  - or shuffle around the tiles in either the pause-menu tileset or HUD tilset, to make the unused tiles line up.
  - or see if somehow there actually already are 4 unused tiles that we could use in both tile sets.
- add rolling saves (to protect against saving where you can't get out)
- fix new game on second file (or after deleting first file)
- restore top of sand falls back to vanilla width (only the bottom needs to be 4 tiles)
- fix internal checksum in output ROM
- add summary to spoiler log (include area of assigned item).
- Warn if base ROM checksum does not match vanilla.
- Find some way to handle Baby metroid drain.
- keep item tile blue for locations locked by Wrecked Ship or Zebes Awake (or maybe for not-collected items in general?)
- clean up the code everywhere
- add option for start-select teleport to ship (only at save stations?).
- add README
    - make
- title graphics
  - title
     - sprites GFX: $95:80D8 ("Super Metroid" graphics, "Nintendo", etc.):
         - bank pointer to sprite GFX at $8B:9295
         - word pointer to sprite GFX at $8B:9299
     - spritemap: $8C:879D (also $8C:833D but this is unused)?
         - free space at $8C:F760
         - (2-byte) pointer to spritemap: $8B:A0C5
         - Description of spritemap format: $A9:93EE
  - title BG GFX: $94:E000 (0xA6000)
  - title BG tilemap: $96:FC04 (0xB7C04)
- take shinespark health requirements into account properly
- redo the front-end.
  - make it so client can save presets.
- fix timestamps in zip file
- detect client hang-up and abort (probably requires switching to websocket request)
- fix eye door graphics in room before rinkas
   - also fake gray door graphics in Kraid room, Phantoon room
- fix camera when coming into shaktool right side
- fix wall that spawns in tourian escape room 1
- fix new game on second file: some data comes from other file?
- fix plasma room (to not assume that the enemies need to be killed)
- escape setup: mark bosses dead
- fix map when using elevators (to set tiles to explored)
- block left side of mother brain room and crocomire room (grey door)
	- and possibly right of kraid, or change spawn? (camera glitchy)
- door randomization
  - tie together plms for the two sides of door?
- cross-area transitions
  - to fix graphical glitches (look into using special GFX flag?)
- try to balance map stations across areas
	- convert one tourian save to a map, so that each area gets a map station?
		- remove asm that automatically gives map in first tourian room
- balance save station distribution
- balance boss distribution (one boss per area, corresponding to vanilla?)
- fix suit graphics not showing after getting suit (consequence of skipping animation)
- set boss bits earlier in death sequence (to avoid accidentally leaving room before set)
- show map text for cross-area transitions?


Mini-map notes:
- HUD GFX:
    - ROM $9A:B200
- HUD Tilemap:
    - RAM $7E:C608
    - VRAM $5820 (BG3)


Notes on usage of area ($079F and $7E:D918):


Map-related usages: ---------------------------------------------------
Bank $80.asm:$80:85A7 AE 9F 07    LDX $079F  [$7E:079F]
Bank $80.asm:$80:858F AD 9F 07    LDA $079F  [$7E:079F]
	;;; $858C: Load mirror of current area's map explored ;;;

Bank $80.asm:$80:85C9 AD 9F 07    LDA $079F  [$7E:079F]
Bank $80.asm:$80:85E6 AE 9F 07    LDX $079F  [$7E:079F]
	;;; $85C6: Mirror current area's map explored ;;;

Bank $82.asm:$82:941B AD 9F 07    LDA $079F  [$7E:079F]
;;; $93C3: Updates the area and map in the map screen ;;;

Bank $82.asm:$82:9440 AD 9F 07    LDA $079F  [$7E:079F]
Bank $82.asm:$82:9475 AE 9F 07    LDX $079F  [$7E:079F]
;;; $943D:  ;;;
   (subroutine in $93C3: Updates the area and map in the map screen ;;;)

Bank $82.asm:$82:952D AD 9F 07    LDA $079F  [$7E:079F]
Bank $82.asm:$82:9562 AE 9F 07    LDX $079F  [$7E:079F]
;;; $9517: Draw room select map ;;;

Bank $82.asm:$82:962B AD 9F 07    LDA $079F  [$7E:079F]
;;; $9628:  ;;;
		(???)

Bank $82.asm:$82:9ED5 AD 9F 07    LDA $079F  [$7E:079F]
Bank $82.asm:$82:9F01 AD 9F 07    LDA $079F  [$7E:079F]
;;; $9EC4:  ;;;
		(???)

Bank $82.asm:$82:B6BC AD 9F 07    LDA $079F  [$7E:079F]
;;; $B672: Draw map icons ;;;

Bank $82.asm:$82:B71C AD 9F 07    LDA $079F  [$7E:079F]  ;|
Bank $82.asm:$82:B777 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $B6DD:  ;;;
	(??? - related to map icons)

Bank $82.asm:$82:B79C AD 9F 07    LDA $079F  [$7E:079F]
Bank $82.asm:$82:B7BB AD 9F 07    LDA $079F  [$7E:079F]
;;; $B798: Draw save station map icon ;;;

Bank $82.asm:$82:B80E AD 9F 07    LDA $079F  [$7E:079F]
;;; $B805: Draw simple map icon ;;;
; Icons. Missile, energy, map, and debug save. X = type, A = graphic

Bank $82.asm:$82:B896 AE 9F 07    LDX $079F  [$7E:079F]
Bank $82.asm:$82:B8A2 AD 9F 07    LDA $079F  [$7E:079F]
;;; $B892: Display map boss icons ;;;

Bank $82.asm:$82:BB3A AE 9F 07    LDX $079F  [$7E:079F]  ;\
Bank $82.asm:$82:BB46 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $BB30: Display map elevator destinations ;;;
		
Bank $90.asm:$90:A9BE AD 9F 07    LDA $079F  [$7E:079F]  ;|
;;; $A91B: Update mini-map ;;;

Bank $90.asm:$90:AA73 AD 9F 07    LDA $079F  [$7E:079F]  ;\
Bank $90.asm:$90:AA78 6D 9F 07    ADC $079F  [$7E:079F]  ;|
;;; $AA43: Update HUD mini-map tilemap ;;;

Bank $84.asm:$84:8C91 AE 9F 07    LDX $079F  [$7E:079F]
;;; $8C8F: Instruction - activate map station ;;;

Bank $8F.asm:$8F:C90C AE 9F 07    LDX $079F  [$7E:079F]
;;; $C90A: Setup ASM: set collected map ;;;
; Room $DAAE. Tourian -> Crateria 
		(Tourian first room)

Bank $84.asm:$84:B19C AE 9F 07    LDX $079F  [$7E:079F]  ;\
;;; $B18B: Setup - PLM $B6D3 (map station) ;;;
		(checking if collected current area map)

Save/load and file menu usages: ----------------------------------------
Bank $82.asm:$82:DE86 8D 9F 07    STA $079F  [$7E:079F]  ;/
;;; $DE6F: Load room header ;;;

Bank $80.asm:$80:C443 AD 9F 07    LDA $079F  [$7E:079F]
Bank $80.asm:$80:C4AC 8D 9F 07    STA $079F  [$7E:079F]
	;;; $C437: Load from load station ;;;
	(first usage to get index of save station, 
	second to set area from room header)

Bank $81.asm:$81:8023 AD 9F 07    LDA $079F  [$7E:079F]  ;\
Bank $81.asm:$81:8043 AD 9F 07    LDA $079F  [$7E:079F]  ;\
	;;; $8000: Save to SRAM ;;;
	(hijacked by Scyzer's patch)

Bank $81.asm:$81:80F4 8D 9F 07    STA $079F  [$7E:079F]  ;} Area index = [SRAM area index]
Bank $81.asm:$81:8123 8D 9F 07    STA $079F  [$7E:079F]  ; Region = Crateria
	;;; $8085: Load from SRAM ;;;
	(hijacked by Scyzer's patch)

Bank $81.asm:$81:9CEB 8D 9F 07    STA $079F  [$7E:079F]
;;; $9C9E: Save game menu - index 19h:  ;;;

Bank $81.asm:$81:A395 AD 9F 07    LDA $079F  [$7E:079F]
Bank $81.asm:$81:A3B0 EC 9F 07    CPX $079F  [$7E:079F]
;;; $A37C: File select map - index 1 ;;;

Bank $81.asm:$81:A57D AC 9F 07    LDY $079F  [$7E:079F]
;;; $A578: File select map - index 12h ;;;

Bank $81.asm:$81:A587 AC 9F 07    LDY $079F  [$7E:079F]
;;; $A582: File select map - index 3: Load area select background tilemap ;;;


Bank $81.asm:$81:A8B5 8D 9F 07    STA $079F  [$7E:079F]
Bank $81.asm:$81:A8CA 8D 9F 07    STA $079F  [$7E:079F]
Bank $81.asm:$81:A8E2 AD 9F 07    LDA $079F  [$7E:079F]
;;; $A8A9:  ;;;
	(???)

Bank $81.asm:$81:AB1A AD 9F 07    LDA $079F  [$7E:079F]
;;; $AAAC: File select map - index 7 ;;;

Bank $81.asm:$81:AD3C 8D 9F 07    STA $079F  [$7E:079F]
;;; $AD17: File select map - index 9 ;;;

Bank $81.asm:$81:ADC0 AD 9F 07    LDA $079F  [$7E:079F]
Bank $81.asm:$81:ADF2 AD 9F 07    LDA $079F  [$7E:079F]
Bank $81.asm:$81:AE05 AD 9F 07    LDA $079F  [$7E:079F]
;;; $AD7F: File select map - index Ah: room select map ;;;

Bank $81.asm:$81:AE6A AD 9F 07    LDA $079F  [$7E:079F]
;;; $AE13:  ;;;
	(???)

Bank $81.asm:$81:AFE6 AE 9F 07    LDX $079F  [$7E:079F]
Bank $81.asm:$81:AFEC AC 9F 07    LDY $079F  [$7E:079F]
;;; $AFD3: File select map - index 10h ;;;


Bank $81.asm:$81:B005 AD 9F 07    LDA $079F  [$7E:079F]
;;; $AFF6: File select map - index 14h ;;;


Bank $82.asm:$82:8032 9C 9F 07    STZ $079F  [$7E:079F]  ; Area = Crateria
Bank $82.asm:$82:8044 8D 9F 07    STA $079F  [$7E:079F]  ;} Area = Ceres
;;; $8000: Game state 6/1Fh/28h (loading game data / set up new game / transition to demo) ;;;

Bank $82.asm:$82:86EC 8D 9F 07    STA $079F  [$8F:079F]  ;|
;;; $8679: Load demo room data ;;;


Bank $8B.asm:$8B:A39C 9C 9F 07    STZ $079F  [$7E:079F]  ; Area index = Crateria
;;; $A395: Cinematic function - intro - initial ;;;

Bank $8B.asm:$8B:C10D 8D 9F 07    STA $079F  [$7E:079F]
;;; $C100:  ;;;
		(set area to Ceres when setting up new game)


Other usages: ---------------------------------------------------
Bank $80.asm:$80:81AE AE 9F 07    LDX $079F  [$7E:079F]
	;;; $81A6: Set boss bits in A for current area ;;;

Bank $80.asm:$80:81CA AE 9F 07    LDX $079F  [$7E:079F]
	;;; $81C0: Unused. Clear boss bits in A for current area ;;;

Bank $80.asm:$80:81E4 AE 9F 07    LDX $079F  [$7E:079F]
	;;; $81DC: Checks if the boss bits for the current area match any bits in A ;;;

Bank $80.asm:$80:CD0D AD 9F 07    LDA $079F  [$7E:079F]  ;\
	;;; $CD07: Set elevators as used ;;;

Bank $82.asm:$82:B7D5 AD 9F 07    LDA $079F  [$7E:079F]
;;; $B7D1:  ;;;
; Debug related

Bank $82.asm:$82:B7EF AD 9F 07    LDA $079F  [$7E:079F]
;;; $B7EB:  ;;;
; Debug related

Bank $82.asm:$82:BE5C AD 9F 07    LDA $079F  [$7E:079F]
;;; $BE5A:  ;;;
; So... this routine does some stuff and then crashes?

Bank $82.asm:$82:BEC3 9C 9F 07    STZ $079F  [$7E:079F]
Bank $82.asm:$82:BEC8 AD 9F 07    LDA $079F  [$7E:079F]
Bank $82.asm:$82:BEE0 AE 9F 07    LDX $079F  [$7E:079F]
Bank $82.asm:$82:BEF7 AD 9F 07    LDA $079F  [$7E:079F]
Bank $82.asm:$82:BEFB 8D 9F 07    STA $079F  [$7E:079F]
;;; $BEA3:  ;;;
; So... this routine does some stuff and then crashes as well? Great!


Bank $82.asm:$82:E833 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $E7D3: Load level data, CRE, tile table, scroll data, create PLMs and execute door ASM and room setup ASM ;;;
	(just checking if Ceres)

Bank $82.asm:$82:EADB AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $EA73: Load level, scroll and CRE data ;;;
	(just checking if Ceres)

Bank $84.asm:$84:8D16 AD 9F 07    LDA $079F  [$7E:079F]  ;|
;;; $8CF1: Instruction - activate save station and go to [[Y]] if [save confirmation selection] = no ;;;

Bank $84.asm:$84:B7C3 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $B7C3: Setup - PLM $B7EB (enable sounds in 20h frames, or F0h frames if on Ceres) ;;;
		(just checking if Ceres)

Bank $86.asm:$86:932F AD 9F 07    LDA $079F  [$7E:079F]
;;; $932F:  ;;;
		(something to do with Ridley's fireball -- checking if in Norfair or Tourian?)

Bank $86.asm:$86:9451 AC 9F 07    LDY $079F  [$7E:079F]
;;; $9442: Unused ;;;

Bank $86.asm:$86:AB96 AD 9F 07    LDA $079F  [$7E:079F]
;;; $AB8A: Instruction ;;;
		(checking if Crateria -- something to do with enemy drops)

Bank $89.asm:$89:AC62 AD 9F 07    LDA $079F  [$7E:079F]  ;\
Bank $89.asm:$89:AC98 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $AB82: Load FX header ;;;

Bank $8D.asm:$8D:EEC6 AE 9F 07    LDX $079F  [$7E:079F]  ;|
;;; $EEC5: Pre-instruction - delete palette FX object if area mini-boss is dead ;;;

Bank $8D.asm:$8D:F731 AE 9F 07    LDX $079F  [$7E:079F]  ;|
;;; $F730: Setup - palette FX object $F779 (Brinstar 8) ;;;
		(related to Spore Spawn)

Bank $90.asm:$90:EA57 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $EA45: Pause check ;;;
		(just checking if Ceres)

Bank $90.asm:$90:ED88 AD 9F 07    LDA $079F  [$7E:079F]
;;; $ED88: Footstep graphics ;;;
; Water splashing in Maridia and Crateria, dust if speedrunning.
; Only works on certain frames, assumed to be walking/running


Bank $91.asm:$91:850F AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $84D5: Pause/terminate/reset demo recorder ;;;
; Controller 2 X pauses/terminates demo recorder
; Controller 2 A resets demo recorder

Bank $91.asm:$91:CF40 AD 9F 07    LDA $079F  [$7E:079F]
;;; $CF3E:  ;;;
		(seems related to respawning speedboost block which only works in Brinstar, e.g. in dachora room)

Bank $91.asm:$91:E097 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $E00D: Initialise Samus ;;;
; Executed when loading demo or starting at Ceres/Zebes
		(just checking if Ceres)

Bank $91.asm:$91:F0A5 AD 9F 07    LDA $079F  [$7E:079F]
;;; $F0A5: Handle landing graphics ;;;

Bank $94.asm:$94:8E83 AD 9F 07    LDA $079F  [$7E:079F]
;;; $8E83: Samus block collision reaction - spike block - BTS 0 (generic spike) ;;;
; Unless already hurt, deal 60 damage (environmental) to Samus, unless in WS and Phantoon is alive


Bank $94.asm:$94:908C AD 9F 07    LDA $079F  [$7E:079F]  ;|
;;; $906F: Samus block collision reaction - horizontal - special air ;;;
; Area dependant BTS

Bank $94.asm:$94:90BA AD 9F 07    LDA $079F  [$7E:079F]
;;; $909D: Samus block collision reaction - vertical - special air ;;;
		(Area dependant BTS)

Bank $94.asm:$94:90EC AD 9F 07    LDA $079F  [$7E:079F]
;;; $90CB: Samus block collision reaction - horizontal - special block ;;;
; Check BTS.
; If positive, make a PLM from the table at 9139,X (X=2*BTS, max BTS is 4F).
; If negative, make a region-indexed PLM (91D9 + 20*Area + 2*BTS, max BTS is 0F).
; If PLM fails to be made, JMP $8F49 (normal solid)

Bank $94.asm:$94:9123 AD 9F 07    LDA $079F  [$7E:079F]
;;; $9102: Samus block collision reaction - vertical - special block ;;;
; Check BTS.
; If positive, make a PLM from the table at 9139,X (X=2*BTS, max BTS is 4F).
; If negative, make a region-indexed PLM (91D9 + 20*Area + 2*BTS, max BTS is 0F).
; If PLM fails to be made, JMP $8F82 (normal solid)

Bank $94.asm:$94:98EA AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $98EA: Block inside reaction - special air - BTS 8 (Wrecked Ship treadmill - rightwards) ;;;
		(checking if Wrecked Ship)

Bank $94.asm:$94:9910 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $9910: Block inside reaction - special air - BTS 9 (Wrecked Ship treadmill - leftwards) ;;;

Bank $94.asm:$94:9B2F AD 9F 07    LDA $079F  [$7E:079F]  ;|
;;; $9B16: Block inside reaction - special air ;;;

Bank $94.asm:$94:9D90 AD 9F 07    LDA $079F  [$7F:079F]
;;; $9D71: Block bombed reaction - special block ;;;
; Load the BTS into A.
; If negative, AND with #$007F and use to find a region-indexed PLM (94:9DC4 + Region * 10 + BTS * 2).
; If positive, use as an index for 94:9DA4,X to make a PLM.
; Either way, clear V, SEC, and RTS

Bank $94.asm:$94:9E92 AD 9F 07    LDA $079F  [$7E:079F]
;;; $9E73: Block shot/bombed/grappled reaction - shootable block ;;;
; Check BTS. If positive, create PLM from main table (94:9EA6 + BTS*2, 'max' BTS of 50).
; If negative, create region-indexed PLM (94:9F46 + 10*region + BTS*2, 'max' BTS of 10).
; Either way, clear V, SEC, RTS.

Bank $A0.asm:$A0:A7E7 AD 9F 07    LDA $079F  [$7E:079F]  ;\
Bank $A0.asm:$A0:A88D AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $A6DE: Handles beam damage, freezing, and sound ;;;
		(checks if area is Norfair, for some reason freezing enemies works differently there?)

Bank $A4.asm:$A4:8A73 AE 9F 07    LDX $079F  [$7E:079F]
;;; $8A5A: Initialisation AI - enemy $DDBF (Crocomire) ;;;
		(checks area mini-boss bit to see if Crocomire is already dead)

Bank $A4.asm:$A4:9B90 AE 9F 07    LDX $079F  [$7E:079F]
;;; $9B86:  ;;;
		(set area mini-boss bit when Crocomire is killed)

Bank $A4.asm:$A4:F67A AE 9F 07    LDX $079F  [$7E:079F]
;;; $F67A: Initialisation AI - enemy $DDFF (Crocomire's tongue) ;;;
		(checks area mini-boss bit to see if Crocomire is already dead)

Bank $A5.asm:$A5:92D4 AE 9F 07    LDX $079F  [$7E:079F]
;;; $92AB:  ;;;
		(set area boss bit when Draygon is killed)

Bank $A5.asm:$A5:EA8F AE 9F 07    LDX $079F  [$7E:079F]  ;\
;;; $EA2A: Initialisation AI - enemy $DF3F/$DF7F (Spore Spawn) ;;;
		(check area mini-boss bit to see if Spore Spawn is already dead)

Bank $A5.asm:$A5:EE30 AE 9F 07    LDX $079F  [$7E:079F]
;;; $EDF3: Spore Spawn reaction ;;;
		(set area mini-boss bit when Spore Spawn is killed)

Bank $A6.asm:$A6:A0F5 AE 9F 07    LDX $079F  [$7E:079F]
;;; $A0F5..EFB0: Ridley ;;;
;;; $A0F5: Initialisation AI - enemy $E13F/$E17F (Ridley) ;;;
		(check area boss bit to see if Ridley is dead)

Bank $A6.asm:$A6:A15C AD 9F 07    LDA $079F  [$7E:079F]
Bank $A6.asm:$A6:A369 AC 9F 07    LDY $079F  [$7E:079F]
Bank $A6.asm:$A6:A424 AD 9F 07    LDA $079F  [$7E:079F]
Bank $A6.asm:$A6:A469 AD 9F 07    LDA $079F  [$7E:079F]
Bank $A6.asm:$A6:A478 AD 9F 07    LDA $079F  [$7E:079F]
;;; $A0F5..EFB0: Ridley ;;;
		(check if area is Norfair)

Bank $A6.asm:$A6:C369 AD 9F 07    LDA $079F  [$7E:079F]
;;; $C2B1: Handle typewriter text ;;;
		(check if area is Ceres)

Bank $A6.asm:$A6:D914 AD 9F 07    LDA $079F  [$7E:079F]
Bank $A6.asm:$A6:D93B AD 9F 07    LDA $079F  [$7E:079F]
;;; $D914:  ;;;
; Cause room shaking, only happens in Ceres. Has unreachable code for Norfair room shaking

Bank $A6.asm:$A6:DF8A AD 9F 07    LDA $079F  [$7E:079F]
;;; $DF8A: Enemy shot - enemy $E13F/$E17F (Ridley) ;;;
		(check if area is Norfair)

Bank $A6.asm:$A6:E4D2 AD 9F 07    LDA $079F  [$7E:079F]
;;; $E4D2: Instruction ;;;
; If in Norfair or Samus is below 30 health, go to next instruction. Else go to argument, and set main AI script timer to 8

Bank $A6.asm:$A6:F66B AE 9F 07    LDX $079F  [$7E:079F]  ;\
;;; $F66A: Instruction - go to parameter if area boss is not dead ;;;
		(check if area is boss is dead -- for Ceres Ridley?)

Bank $A7.asm:$A7:A92D AE 9F 07    LDX $079F  [$7E:079F]
;;; $A92C: Check if Kraid has died ;;;

Bank $A7.asm:$A7:C822 AE 9F 07    LDX $079F  [$80:079F]  ;\
;;; $C815: Kraid function - fade in regular background - fade in BG palette 6 ;;;

Bank $A7.asm:$A7:DB7B AE 9F 07    LDX $079F  [$7E:079F]
;;; $DB3D:  ;;;
		(set boss bit when Phantoon killed)

Bank $A8.asm:$A8:CB77 AE 9F 07    LDX $079F  [$7E:079F]  ;\
;;; $CB77: Initialisation AI - enemy $E8FF (Wrecked Ship robot) ;;;

Bank $A8.asm:$A8:D196 AE 9F 07    LDX $079F  [$7E:079F]  ;\
;;; $D192: Enemy shot - enemy $E8FF (Wrecked Ship robot) ;;;

Bank $A8.asm:$A8:E668 AE 9F 07    LDX $079F  [$7E:079F]
;;; $E637: Initialisation AI - enemy $EA3F (Wrecked Ship spark) ;;;

Bank $B4.asm:$B4:942D AD 9F 07    LDA $079F  [$7E:079F]  ;|
;;; $941D: Debug. Draw enemy set name ;;;